= パラメータファイル

データベースやJava Beanを初期化する初期化ファイルや、データベースやJava Beanの値を検証する期待値ファイルを「パラメータファイル」と呼びます。 +
パラメータファイルはMicrosoft Excel形式、もしくはCSV形式で作成します。

== 基本的な記載方法

=== Excel形式

Excel形式の場合、シート名にテーブル名、Java Beanクラスの単純名を指定します。 +
1行目はヘッダ行で、テーブルの列名、Java Beanのフィールド名を記載します。 +
2行目以降はデータ行で、テーブルの列値、Java beanのフィールド値を記載します。

.Excel形式のサンプル
image::figure/excel-basic.ja.svg[Excel形式の基本]

=== CSV形式

CSV形式の場合、ファイル名にテーブル名を指定します。 +
1行目はヘッダ行で、テーブルの列名、Java Beanのフィールド名を記載します。 +
2行目以降はデータ行で、テーブルの列値、Java beanのフィールド値を記載します。

.CSV形式のサンプル
image::figure/csv-basic.ja.svg[CSV形式の基本]

== 数値項目の記載方法

テーブルの数値列やJava Beanの数値フィールドに対応するパラメータファイルの記載方法は以下の通りとなります。

.数値項目の記載方法
[options="header"]
|===
|記載方法 |記載サンプル |備考
|Excel数値 |12345.678 |Excel形式のみ +
Excel形式で表現できる数値は整数部と小数部の桁数の合計が15桁まで
|数値を表す文字列 |1234567890.123456789|Excel形式で表現できる桁数を超える場合は文字列として数値を指定
|===

== 日付や時刻項目の記載方法

テーブルの日付列や時刻列やJava Beanの日付フィールドや時刻フィールドに対応するパラメータファイルの記載方法は以下の通りとなります。

=== 日時項目

日付と時刻を表すテーブルの列やJava Beanのフィールドのパラメータファイルの記載方法は以下の通りとなります。

.日時項目の記載方法
[options="header"]
|===
|記載方法 |記載サンプル |備考
|Excel日時シリアル値 |44530.5515644329 +
(= 2021-11-30 13:14:15.167) |Excel形式のみ +
日時シリアル値の精度はミリ秒
|ナノ秒まで指定した文字列 |2021-11-30 13:14:15.987654321|
|ミリ秒まで指定した文字列 |2021-11-30 13:14:15.167|ミリ秒未満のナノ秒部分は0となる
|秒まで指定した文字列 |2021-11-30 13:14:15|ナノ秒部分は0となる
|分まで指定した文字列 |2021-11-30 13:14|秒、ナノ秒部分は0となる
|===

=== 日付項目

日付を表すテーブルの列やJava Beanのフィールドのパラメータファイルの記載方法は以下の通りとなります。

.日付項目の記載方法
[options="header"]
|===
|記載方法 |記載サンプル |備考

|Excel日時シリアル値 |44198 (=2021-1-2) |Excel形式のみ
|日付文字列 |2021-1-2 +
2021-01-02 |0埋めは任意
|===

=== 時刻項目

時刻を表すテーブルの列やJava Beanのフィールドのパラメータファイルの記載方法は以下の通りとなります。

.時刻項目の記載方法
[options="header"]
|===
|記載方法 |記載サンプル |備考
|Excel日時シリアル値 |0.5515644329 +
(= 13:14:15.167) |Excel形式のみ +
日時シリアル値の精度はミリ秒
|ナノ秒まで指定した文字列 |13:14:15.987654321|
|ミリ秒まで指定した文字列 |13:14:15.167|ミリ秒未満のナノ秒部分は0となる
|秒まで指定した文字列 |13:14:15|ナノ秒部分は0となる
|分まで指定した文字列 |13:14|秒、ナノ秒部分は0となる
|===

=== 現在日時からの差分指定

現在日時から値を生成する方法があります。

.現在日時を使った日時項目の記載方法
[options="header"]
|===
|記載方法 |記載サンプル |備考
|現在日時 |[now] |現在日時となる
|現在日時との差分 |[now+1d-1s]|現在日時からの差を指定した日時となる +
差分は「符号(`+`、`-`) + 数値 + 単位」で指定 +
以下の単位が使用できる +
* `y` : 年 +
* `M` : 月 +
* `d` : 日 +
* `h` : 時 +
* `m` : 分 +
* `s` : 秒
|現在日と指定時刻 |[now 23:59:59]|日付は現在日、時刻は指定した時刻となる +
指定する時刻は`java.time.LocalTime#parse(String)`で解析可能なフォーマットで指定
|現在日との差分と指定時刻 |[now-1d 23:59:59]|現在日からの差と指定した時刻となる
|===

== バイナリ項目の記載方法

テーブルのBLOB列やJava Beanのbyte配列フィールドに対応するパラメータファイルの記載方法は以下の通りとなります。

.バイナリ項目の記載方法
[options="header"]
|===
|記載方法 |記載サンプル |備考
|URL |file:./src/test/resources/sample.txt |URLで指定したファイルをバイナリファイルとして読み込んだ値となる
|ファイルパス |./src/test/resources/sample.txt |指定したファイルをバイナリファイルとして読み込んだ値となる
|バイナリをBASE64でエンコードした値 |YWJj +
(= 0x61, 0x62, 0x63) |文字列をBASE64でデコードした値となる
|文字列 |abc |プラットフォームのデフォルトの文字セットで文字列をバイト・シーケンスにエンコードした値となる
|===

パラメータファイルに指定された値を使って、以下の優先順位で評価します。

. URL形式の文字列の場合はURLとみなし、URLで指定したファイルを読み込んだ結果を使用する。
. ファイルパスとみなしてファイルの存在をチェックし、存在した場合は指定したファイルを読み込んだ結果を使用する。
. BASE64でデコードし、デコードできた場合はデコードした値を使用する。
. 値をプラットフォームのデフォルトの文字セットでバイト・シーケンスにエンコードした値を使用する。

パラメータファイルの値の先頭に形式を示すキーワードを指定することで、形式を明示することが可能です。

.形式を指定したバイナリ項目の記載方法
[options="header"]
|===
|記載方法 |記載サンプル |備考
|`[URL]` + URL |[URL]file:./src/test/resources/sample.txt |URLで指定したファイルをバイナリファイルとして読み込んだ値となる
|`[FILE]` + ファイルパス |[FILE]./src/test/resources/sample.txt |指定したファイルをバイナリファイルとして読み込んだ値となる
|`[BASE64]` + バイナリをBASE64でエンコードした値 |[BASE64]YWJj +
(= 0x61, 0x62, 0x63) |文字列をBASE64でデコードした値となる
|`[TEXT]` + 文字列 |[TEXT]abc |UTF-8文字セットで文字列をバイト・シーケンスにエンコードした値となる
|`[TEXT エンコード]` + 文字列 |[TEXT Shift-JIS]abc |指定した文字セットで文字列をバイト・シーケンスにエンコードした値となる
|===

== NULL値の記載方法

NULL値を記載する方法は、Excel形式とCSV形式で違うので注意が必要です。

[options="header"]
|===
|ファイル形式 |記載方法 |備考
|Excel形式 |セルに値を指定しない |NULLでなく空文字列を指定する場合、セルにクォーテーション(`'`)を指定
|CSV形式 |文字列`NULL`を指定する |NULLを示す文字列を変更する場合、`CsvMeta`アノテーションの`nullString`属性でNULLを示す文字列を指定
|===
